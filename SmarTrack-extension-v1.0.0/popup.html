<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SmarTrack - Save Link</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      width: 360px;
      min-height: 400px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      background: #f8fafc;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body.toast-only {
      background: transparent !important;
      width: 100% !important;
      min-height: 0 !important;
      height: auto !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    body.toast-only .container {
      display: none !important;
    }

    body.toast-only .toast {
      position: relative !important;
      top: 0 !important;
      left: 0 !important;
      transform: none !important;
      margin: 20px auto !important;
      display: block !important;
    }

    .container {
      background: white;
    }

    .header {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #6366f1 100%);
      padding: 12px 16px;
      color: white;
      text-align: center;
      box-shadow: 0 2px 8px rgba(30, 64, 175, 0.15);
    }

    .logo {
      width: 28px;
      height: 28px;
      margin: 0 auto 6px;
      background: white;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      color: #1e40af;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    .title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 3px;
      margin-top: 0;
    }

    .subtitle {
      font-size: 11px;
      opacity: 0.9;
    }

    .open-dashboard {
      margin-top: 6px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 6px 12px;
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 6px;
      color: #fff;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
    }

    .open-dashboard:hover {
      background: rgba(255,255,255,0.25);
      border-color: rgba(255,255,255,0.5);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .open-dashboard:active {
      transform: translateY(0);
    }

    .content {
      padding: 16px;
    }

    .page-preview {
      background: white;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 14px;
      display: flex;
      gap: 10px;
      align-items: center;
      border: 1.5px solid #e2e8f0;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease;
    }

    .page-preview:hover {
      border-color: #cbd5e1;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .preview-thumbnail {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      flex-shrink: 0;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      overflow: hidden;
      display: none !important;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
      border: 1px solid #e2e8f0;
    }

    .preview-thumbnail.has-image {
      display: block !important;
    }

    .preview-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .preview-content {
      flex: 1;
      min-width: 0;
    }

    .preview-title {
      font-size: 13px;
      font-weight: 600;
      color: #0f172a;
      margin-bottom: 3px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      line-height: 1.3;
    }

    .preview-url {
      font-size: 11px;
      color: #64748b;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .preview-url::before {
      content: 'üîó';
      font-size: 10px;
      opacity: 0.7;
    }

    .content-type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      flex-shrink: 0;
      border: 1px solid currentColor;
      opacity: 0.9;
    }

    .content-type-badge[data-type="blog"] {
      background: #dbeafe;
      color: #1e40af;
    }

    .content-type-badge[data-type="article"] {
      background: #e0e7ff;
      color: #3730a3;
    }

    .content-type-badge[data-type="video"] {
      background: #fce7f3;
      color: #9f1239;
    }

    .content-type-badge[data-type="pdf"] {
      background: #fee2e2;
      color: #991b1b;
    }

    .content-type-badge[data-type="document"] {
      background: #fef3c7;
      color: #92400e;
    }

    .content-type-badge[data-type="image"] {
      background: #d1fae5;
      color: #065f46;
    }

    .content-type-badge[data-type="website"] {
      background: #f1f5f9;
      color: #475569;
    }

    .dupe {
      background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
      border: 1.5px solid #fdba74;
      color: #9a3412;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 14px;
      box-shadow: 0 1px 4px rgba(251, 146, 60, 0.1);
      animation: slideIn 0.3s ease-out;
    }

    .dupe h4 {
      font-size: 12px;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .dupe h4::before {
      content: '‚ö†Ô∏è';
      font-size: 13px;
    }

    .dupe ul {
      list-style: none;
      display: grid;
      gap: 6px;
    }

    .dupe .row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dupe .open {
      background: #fff;
      border: 1px solid #f59e0b;
      color: #9a3412;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
    }

    .form-group {
      margin-bottom: 14px;
    }

    .label {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 12px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 6px;
      letter-spacing: -0.01em;
    }
    
    .label-icon {
      font-size: 12px;
      opacity: 0.7;
    }

    .input {
      width: 100%;
      padding: 9px 12px;
      border: 1.5px solid #e2e8f0;
      border-radius: 7px;
      font-size: 13px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      background: white;
      color: #1e293b;
      line-height: 1.4;
    }
    
    .input::placeholder {
      color: #94a3b8;
    }

    .input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: #fafbfc;
    }

    .input:hover:not(:focus) {
      border-color: #cbd5e1;
      background: #fafbfc;
    }

    .textarea {
      resize: vertical;
      min-height: 70px;
      font-family: inherit;
    }

    .select {
      width: 100%;
      padding: 9px 12px;
      border: 1.5px solid #e2e8f0;
      border-radius: 7px;
      font-size: 13px;
      background: white;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      color: #1e293b;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 14px;
      padding-right: 36px;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    
    .select:hover:not(:focus) {
      border-color: #cbd5e1;
      background-color: #fafbfc;
    }
    
    .select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background-color: #fafbfc;
    }


    .actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      padding-top: 2px;
    }

    .hint {
      margin-top: 8px;
      font-size: 10px;
      color: #94a3b8;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      letter-spacing: 0.01em;
    }
    
    .hint::before {
      content: 'üí°';
      font-size: 11px;
    }

    .btn {
      flex: 1;
      padding: 10px 16px;
      border: none;
      border-radius: 7px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      letter-spacing: -0.01em;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn:active::before {
      width: 300px;
      height: 300px;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
      border: 1.5px solid transparent;
    }

    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.45);
    }
    
    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }


    .btn-secondary {
      background: white;
      color: #64748b;
      border: 1.5px solid #e2e8f0;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    }

    .btn-secondary:hover:not(:disabled) {
      background: #f8fafc;
      border-color: #cbd5e1;
      color: #475569;
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }
    
    .btn-secondary:active:not(:disabled) {
      transform: translateY(0);
      background: #f1f5f9;
    }

    .status {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      text-align: center;
      font-weight: 500;
    }

    .status-success {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #86efac;
      font-weight: 600;
      font-size: 14px;
    }

    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 18px 32px;
      border-radius: 12px;
      box-shadow: 0 12px 40px rgba(16, 185, 129, 0.4);
      z-index: 10000;
      animation: slideDown 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      font-weight: 600;
      min-width: 220px;
      text-align: center;
      font-size: 15px;
      letter-spacing: 0.3px;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-30px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0) scale(1);
      }
    }

    .toast-error {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      box-shadow: 0 12px 40px rgba(239, 68, 68, 0.4);
    }

    .status-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
      animation: shake 0.5s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }

    .pulse {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .loading {
      display: none;
      text-align: center;
      padding: 40px 16px;
    }

    .spinner {
      width: 36px;
      height: 36px;
      border: 3px solid #e2e8f0;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
      margin: 0 auto 12px;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 13px;
      color: #64748b;
      font-weight: 500;
    }

    .hidden {
      display: none !important;
    }

    .selected-text-info {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border: 1.5px solid #93c5fd;
      color: #1e40af;
      padding: 9px 12px;
      border-radius: 8px;
      font-size: 12px;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      box-shadow: 0 1px 4px rgba(59, 130, 246, 0.1);
      animation: slideIn 0.3s ease-out;
    }

    .selected-text-info:empty {
      display: none;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">Save to SmarTrack</div>
      <div class="subtitle">Smart Research Tracking</div>
      <button id="openDashboardBtn" class="open-dashboard">Open Dashboard ‚Üó</button>
    </div>

    <div class="content">
      <!-- Login view -->
      <div id="loginView" class="hidden">
        <div style="text-align: center; padding: 40px 16px 30px;">
          <div style="font-size: 42px; margin-bottom: 14px; animation: pulse 2s ease-in-out infinite;">üîê</div>
          <h2 style="font-size: 16px; color: #0f172a; margin-bottom: 8px; font-weight: 700;">Login Required</h2>
          <p style="font-size: 13px; color: #64748b; margin-bottom: 20px; line-height: 1.5;">
            Please log in to SmarTrack to start<br>saving and organizing your links
          </p>
          <button id="loginBtn" class="btn btn-primary" style="width: 100%; padding: 10px 16px;">
            üöÄ Login to SmarTrack
          </button>
        </div>
      </div>

      <!-- Main form view -->
      <div id="mainView">
      <div class="page-preview">
        <div class="preview-thumbnail" id="thumbnail"></div>
        <!-- Only show favicon if no thumbnail, logic handled in JS or CSS but easier to just keep both structure and hide one via CSS if needed. 
             User wants small image. If image exists, maybe hide favicon? Or show image INSTEAD of favicon? 
             The screenshot shows an image where the favicon was. 
             Let's keep favicon as fallback or secondary. -->
        <div class="preview-favicon" id="favicon"></div>
        <div class="preview-content">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
            <div class="preview-title" id="pageTitle" style="flex: 1; min-width: 0;">Loading...</div>
            <span id="contentTypeBadge" class="content-type-badge" style="display: none;"></span>
          </div>
          <div class="preview-url" id="pageUrl">Loading...</div>
        </div>
      </div>

      <div id="duplicatesPanel" class="dupe hidden">
        <h4>Possible duplicates found</h4>
        <ul id="dupeList"></ul>
      </div>

      <div class="selected-text-info" id="selectedTextInfo"></div>

      <form id="linkForm">
        <div class="form-group">
          <label class="label" for="title">
            <span class="label-icon">üìù</span>
            <span>Title</span>
          </label>
          <input type="text" id="title" class="input" placeholder="Enter a descriptive title" required>
        </div>

        <div class="form-group">
          <label class="label" for="description">
            <span class="label-icon">üìÑ</span>
            <span>Description</span>
          </label>
          <textarea id="description" class="input textarea" placeholder="Add notes, key takeaways, or a summary..."></textarea>
        </div>

        <div class="form-group">
          <label class="label" for="category">
            <span class="label-icon">üè∑Ô∏è</span>
            <span>Category</span>
          </label>
          <select id="category" class="select"></select>
          <div id="customCategoryRow" class="hidden" style="margin-top:8px; display:flex; gap:6px; animation: slideIn 0.2s ease-out;">
            <input id="customCategoryInput" class="input" placeholder="Type a new category name" style="flex:1;" />
            <button id="saveCustomCategoryBtn" class="btn btn-secondary" type="button" style="flex:0 0 auto; padding: 9px 16px; font-size: 12px;">Add</button>
          </div>
          <div style="margin-top:6px; display:none;">
            <button id="addCategoryBtn" type="button" class="btn btn-secondary" style="padding:8px 10px; font-size:12px;">+ Add custom category</button>
          </div>
        </div>

        <div class="actions">
          <button type="button" id="cancelBtn" class="btn btn-secondary">Cancel</button>
          <button type="submit" id="saveBtn" class="btn btn-primary">üíæ Save Link</button>
        </div>
        <div class="hint">Press ‚åò/Ctrl + Enter to save</div>
      </form>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">Saving to SmarTrack...</div>
      </div>

      <div class="status hidden" id="status"></div>
      </div>
    </div>
  </div>

  <script src="utils/config.js"></script>
  <script src="utils/backendApi.js"></script>
  <script src="popup.js"></script>
</body>
</html>
