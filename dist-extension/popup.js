(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))m(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const y of o.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&m(y)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function m(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();const L="modulepreload",T=function(e){return"/"+e},C={},P=function(n,r,m){let t=Promise.resolve();if(r&&r.length>0){let g=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};var y=g;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");t=g(r.map(l=>{if(l=T(l),l in C)return;C[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":L,u||(p.as="script"),p.crossOrigin="",p.href=l,s&&p.setAttribute("nonce",s),document.head.appendChild(p),u)return new Promise((i,f)=>{p.addEventListener("load",i),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return t.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return n().catch(o)})};console.log("🚀 Smart Research Tracker Extension Popup Loaded");let w="link";const v=document.getElementById("board"),_=document.getElementById("linkFields"),I=document.getElementById("status");chrome.storage.local.get(["firstLoad"],e=>{e.firstLoad||(b('👋 Welcome! Click "Save to Research" to save this page.',"info"),chrome.storage.local.set({firstLoad:!0}))});chrome.tabs.query({active:!0,currentWindow:!0},e=>{const n=e[0];n&&n.url&&!n.url.startsWith("chrome://")&&chrome.storage.sync.get({autoFillTitle:!0},r=>{const m=document.getElementById("title");m&&n.title&&r.autoFillTitle?(m.value=n.title,m.placeholder="Page title (auto-filled)"):m&&(m.placeholder="Page title");const t=new URL(n.url);b(`📄 Ready to save: ${t.hostname}`,"info")})});const d=document.getElementById("labelSelect"),E=document.getElementById("labelInput"),x=document.querySelectorAll(".cat");x.forEach(e=>{e.addEventListener("click",()=>{x.forEach(n=>n.classList.remove("active")),e.classList.add("active"),w=e.dataset.cat,S()})});const S=()=>{const e=w==="link";_.style.display=e?"block":"none",v.style.display=e?"block":"none",document.getElementById("saveBtn").disabled=!e};S();chrome.storage.local.get(["boards","labels","links"],e=>{const n=(e.boards||[]).filter(t=>t.title!=="Default");n.length===0?v.style.display="none":n.forEach(t=>{const o=document.createElement("option");o.value=t.id,o.textContent=t.title,v.appendChild(o)});let r=e.labels||[];if((!r||r.length===0)&&e.links){const t=new Set;e.links.forEach(o=>{o.label&&t.add(o.label)}),r=Array.from(t)}const m=()=>{const t=document.createElement("option");return t.value="__new",t.textContent="➕ New label…",t};r.length?(d.style.display="block",d.innerHTML="",r.forEach(t=>{const o=document.createElement("option");o.value=t,o.textContent=t,d.appendChild(o)}),d.appendChild(m()),d.addEventListener("change",()=>{d.value==="__new"&&(d.style.display="none",E.style.display="block",E.focus())})):E.style.display="block",chrome.tabs.query({active:!0,currentWindow:!0},t=>{const o=t[0]?.id;o&&chrome.tabs.sendMessage(o,{type:"GET_LABELS"},y=>{if(chrome.runtime.lastError)return;const a=y?.labels||[];if(!a.length)return;const s=new Set;Array.from(d.options).forEach(l=>{l.value!=="__new"&&s.add(l.value)});let g=!1;a.forEach(l=>{if(!s.has(l)){const u=document.createElement("option");u.value=l,u.textContent=l;const c=d.querySelector('option[value="__new"]');c?d.insertBefore(u,c):d.appendChild(u),s.add(l),g=!0}}),g&&(d.style.display="block",E.style.display,chrome.storage.local.set({labels:Array.from(s)}))})})});chrome.tabs.query({active:!0,currentWindow:!0},e=>{const n=e[0],r=document.getElementById("title");r&&n&&n.title&&(r.value=n.title,document.getElementById("saveBtn").disabled=!1)});document.getElementById("saveBtn").addEventListener("click",()=>{if(document.getElementById("saveBtn").disabled=!0,I.textContent="Saving…",w!=="link"){I.textContent="Only Link saving supported right now.";return}const n=v.value;let r="";d&&d.style.display!=="none"&&(r=d.value==="__new"?"":d.value),E&&E.style.display!=="none"&&(r=E.value.trim());const m=document.getElementById("priority").value;chrome.tabs.query({active:!0,currentWindow:!0},t=>{const o=t[0];!o?.url||o.id===void 0||chrome.scripting.executeScript({target:{tabId:o.id},func:async()=>{const y=document.title||"",a=document.querySelector('meta[name="description"]')?.content||"";async function s(){await(async()=>{try{const i=Array.from(document.querySelectorAll("button, a, span")),f=/(read more|show more|continue reading|more…|more\u2026|read full)/i;i.forEach(h=>{if(f.test(h.textContent||""))try{h.click()}catch{}});for(let h=0;h<3;h++)window.scrollTo(0,document.body.scrollHeight),await new Promise(k=>setTimeout(k,350))}catch{}})();const u=()=>{const i=document.cloneNode(!0);return["script","style","nav","header","footer","aside",".ads",'[aria-label*="advert" i]','[role="banner" i]','[role="contentinfo" i]'].forEach(h=>{i.querySelectorAll(h).forEach(k=>k.remove())}),i};let c="";try{const{Readability:i}=await P(async()=>{const{Readability:h}=await import("https://cdn.jsdelivr.net/npm/@mozilla/readability@0.4.4/+esm");return{Readability:h}},[]),f=new i(u()).parse();f?.textContent&&(c=f.textContent)}catch{}if(c.trim().length<500)try{const i=document.body?.innerText||"";i.trim().length>c.length&&(c=i)}catch{}if(c.trim().length<500)try{const i=document.documentElement?.innerText||"";i.trim().length>c.length&&(c=i)}catch{}const p=[/get the .*app/i,/subscribe.*substack/i,/^share .*twitter$/i,/advertisement/i,/sponsored/i,/sign up/i];return c=c.split(`
`).filter(i=>{const f=i.trim();return!(!f||f.split(/\s+/).length<4||p.some(h=>h.test(f)))}).join(`
`),c.slice(0,5e5)}const g=await s();return{title:y,description:a,text:g}}},y=>{const a=y?.[0]?.result||{title:"",description:"",text:""},s=document.getElementById("saveBtn"),g=s.textContent;s.textContent="🔄 Saving...",s.disabled=!0,chrome.runtime.sendMessage({type:"SAVE_LINK",payload:{url:o.url,title:a.title,boardId:n,label:r,description:a.description,priority:m,tabId:o.id,pageText:a.text}},l=>{chrome.runtime.lastError?(b("❌ Failed to save. Please try again.","error"),B(s,g)):(b("✅ Page saved successfully!","success"),chrome.storage.sync.get({autoClose:!0},u=>{u.autoClose&&setTimeout(()=>window.close(),2e3)}))})})})});document.getElementById("openDashboardBtn").addEventListener("click",()=>{const e=document.getElementById("openDashboardBtn"),n=e.textContent;e.textContent="🔄 Opening...",e.disabled=!0,chrome.storage.sync.get({dashboardUrl:"http://localhost:5173/",fallbackUrl:"https://smartresearchtracker.vercel.app/"},r=>{chrome.tabs.create({url:r.dashboardUrl},m=>{chrome.runtime.lastError?chrome.tabs.create({url:r.fallbackUrl},t=>{chrome.runtime.lastError?b("❌ Could not open dashboard. Check your settings.","error"):b("✅ Dashboard opened successfully!","success"),B(e,n)}):(b("✅ Dashboard opened successfully!","success"),B(e,n))})})});document.getElementById("toggleSettingsBtn").addEventListener("click",()=>{const e=document.getElementById("settingsPanel"),n=document.getElementById("toggleSettingsBtn");e.style.display==="none"?(e.style.display="block",n.textContent="✕ Close",A()):(e.style.display="none",n.textContent="⚙️ Settings")});function A(){chrome.storage.sync.get({dashboardUrl:"http://localhost:5173/",autoFillTitle:!0,autoClose:!0},e=>{document.getElementById("quickDashboardUrl").value=e.dashboardUrl,document.getElementById("quickAutoFill").checked=e.autoFillTitle,document.getElementById("quickAutoClose").checked=e.autoClose})}document.getElementById("saveQuickSettings").addEventListener("click",()=>{const e={dashboardUrl:document.getElementById("quickDashboardUrl").value.trim(),autoFillTitle:document.getElementById("quickAutoFill").checked,autoClose:document.getElementById("quickAutoClose").checked};chrome.storage.sync.set(e,()=>{b("✅ Quick settings saved!","success")})});document.getElementById("openFullSettings").addEventListener("click",()=>{chrome.runtime.openOptionsPage(()=>{chrome.runtime.lastError&&chrome.tabs.create({url:"chrome://extensions/?id="+chrome.runtime.id})})});function b(e,n="info"){const r=document.getElementById("status");r.textContent=e,r.className=`status ${n}`,r.style.display="block",n==="success"&&setTimeout(()=>{r.style.display="none"},3e3)}function B(e,n){e.textContent=n,e.disabled=!1}
