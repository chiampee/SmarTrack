(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))y(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const p of t.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&y(p)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function y(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();const I="modulepreload",L=function(n){return"/"+n},x={},_=function(l,s,y){let e=Promise.resolve();if(s&&s.length>0){let g=function(r){return Promise.all(r.map(u=>Promise.resolve(u).then(o=>({status:"fulfilled",value:o}),o=>({status:"rejected",reason:o}))))};var p=g;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),i=c?.nonce||c?.getAttribute("nonce");e=g(s.map(r=>{if(r=L(r),r in x)return;x[r]=!0;const u=r.endsWith(".css"),o=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":I,u||(h.as="script"),h.crossOrigin="",h.href=r,i&&h.setAttribute("nonce",i),document.head.appendChild(h),u)return new Promise((a,m)=>{h.addEventListener("load",a),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})}))}function t(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return e.then(c=>{for(const i of c||[])i.status==="rejected"&&t(i.reason);return l().catch(t)})};let S="link";const E=document.getElementById("board"),C=document.getElementById("linkFields"),w=document.getElementById("status"),d=document.getElementById("labelSelect"),b=document.getElementById("labelInput"),k=document.querySelectorAll(".cat");k.forEach(n=>{n.addEventListener("click",()=>{k.forEach(l=>l.classList.remove("active")),n.classList.add("active"),S=n.dataset.cat,B()})});const B=()=>{const n=S==="link";C.style.display=n?"block":"none",E.style.display=n?"block":"none",document.getElementById("saveBtn").disabled=!n};B();chrome.storage.local.get(["boards","labels","links"],n=>{const l=(n.boards||[]).filter(e=>e.title!=="Default");l.length===0?E.style.display="none":l.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.title,E.appendChild(t)});let s=n.labels||[];if((!s||s.length===0)&&n.links){const e=new Set;n.links.forEach(t=>{t.label&&e.add(t.label)}),s=Array.from(e)}const y=()=>{const e=document.createElement("option");return e.value="__new",e.textContent="➕ New label…",e};s.length?(d.style.display="block",d.innerHTML="",s.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,d.appendChild(t)}),d.appendChild(y()),d.addEventListener("change",()=>{d.value==="__new"&&(d.style.display="none",b.style.display="block",b.focus())})):b.style.display="block",chrome.tabs.query({active:!0,currentWindow:!0},e=>{const t=e[0]?.id;t&&chrome.tabs.sendMessage(t,{type:"GET_LABELS"},p=>{if(chrome.runtime.lastError)return;const c=p?.labels||[];if(!c.length)return;const i=new Set;Array.from(d.options).forEach(r=>{r.value!=="__new"&&i.add(r.value)});let g=!1;c.forEach(r=>{if(!i.has(r)){const u=document.createElement("option");u.value=r,u.textContent=r;const o=d.querySelector('option[value="__new"]');o?d.insertBefore(u,o):d.appendChild(u),i.add(r),g=!0}}),g&&(d.style.display="block",b.style.display,chrome.storage.local.set({labels:Array.from(i)}))})})});chrome.tabs.query({active:!0,currentWindow:!0},n=>{const l=n[0],s=document.getElementById("title");s&&l&&l.title&&(s.value=l.title,document.getElementById("saveBtn").disabled=!1)});document.getElementById("saveBtn").addEventListener("click",()=>{if(document.getElementById("saveBtn").disabled=!0,w.textContent="Saving…",S!=="link"){w.textContent="Only Link saving supported right now.";return}const l=E.value;let s="";d&&d.style.display!=="none"&&(s=d.value==="__new"?"":d.value),b&&b.style.display!=="none"&&(s=b.value.trim());const y=document.getElementById("priority").value;chrome.tabs.query({active:!0,currentWindow:!0},e=>{const t=e[0];!t?.url||t.id===void 0||chrome.scripting.executeScript({target:{tabId:t.id},func:async()=>{const p=document.title||"",c=document.querySelector('meta[name="description"]')?.content||"";async function i(){await(async()=>{try{const a=Array.from(document.querySelectorAll("button, a, span")),m=/(read more|show more|continue reading|more…|more\u2026|read full)/i;a.forEach(f=>{if(m.test(f.textContent||""))try{f.click()}catch{}});for(let f=0;f<3;f++)window.scrollTo(0,document.body.scrollHeight),await new Promise(v=>setTimeout(v,350))}catch{}})();const u=()=>{const a=document.cloneNode(!0);return["script","style","nav","header","footer","aside",".ads",'[aria-label*="advert" i]','[role="banner" i]','[role="contentinfo" i]'].forEach(f=>{a.querySelectorAll(f).forEach(v=>v.remove())}),a};let o="";try{const{Readability:a}=await _(async()=>{const{Readability:f}=await import("https://cdn.jsdelivr.net/npm/@mozilla/readability@0.4.4/+esm");return{Readability:f}},[]),m=new a(u()).parse();m?.textContent&&(o=m.textContent)}catch{}if(o.trim().length<500)try{const a=document.body?.innerText||"";a.trim().length>o.length&&(o=a)}catch{}if(o.trim().length<500)try{const a=document.documentElement?.innerText||"";a.trim().length>o.length&&(o=a)}catch{}const h=[/get the .*app/i,/subscribe.*substack/i,/^share .*twitter$/i,/advertisement/i,/sponsored/i,/sign up/i];return o=o.split(`
`).filter(a=>{const m=a.trim();return!(!m||m.split(/\s+/).length<4||h.some(f=>f.test(m)))}).join(`
`),o.slice(0,5e5)}const g=await i();return{title:p,description:c,text:g}}},p=>{const c=p?.[0]?.result||{title:"",description:"",text:""};chrome.runtime.sendMessage({type:"SAVE_LINK",payload:{url:t.url,title:c.title,boardId:l,label:s,description:c.description,priority:y,tabId:t.id,pageText:c.text}},()=>{w.textContent="Saved!",setTimeout(()=>window.close(),800)})})})});document.getElementById("openDashboardBtn").addEventListener("click",()=>{chrome.tabs.create({url:"http://localhost:5173/"},n=>{chrome.runtime.lastError&&chrome.tabs.create({url:"https://smartresearchtracker.vercel.app/"})})});document.getElementById("openSettingsBtn").addEventListener("click",()=>{chrome.tabs.create({url:"http://localhost:5173/#/settings"},n=>{chrome.runtime.lastError&&chrome.tabs.create({url:"https://smartresearchtracker.vercel.app/#/settings"})})});
