(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))m(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&m(h)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function m(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();const L="modulepreload",_=function(e){return"/"+e},S={},T=function(n,r,m){let t=Promise.resolve();if(r&&r.length>0){let b=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(a=>({status:"fulfilled",value:a}),a=>({status:"rejected",reason:a}))))};var h=b;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),s=c?.nonce||c?.getAttribute("nonce");t=b(r.map(l=>{if(l=_(l),l in S)return;S[l]=!0;const u=l.endsWith(".css"),a=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${a}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":L,u||(y.as="script"),y.crossOrigin="",y.href=l,s&&y.setAttribute("nonce",s),document.head.appendChild(y),u)return new Promise((i,f)=>{y.addEventListener("load",i),y.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(c){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=c,window.dispatchEvent(s),!s.defaultPrevented)throw c}return t.then(c=>{for(const s of c||[])s.status==="rejected"&&o(s.reason);return n().catch(o)})};console.log("🚀 Smart Research Tracker Extension Popup Loaded");let B="link";const w=document.getElementById("board"),P=document.getElementById("linkFields"),C=document.getElementById("status");chrome.storage.local.get(["firstLoad"],e=>{e.firstLoad||(g('👋 Welcome! Click "Save to Research" to save this page.',"info"),chrome.storage.local.set({firstLoad:!0}))});chrome.tabs.query({active:!0,currentWindow:!0},e=>{const n=e[0];if(n&&n.url&&!n.url.startsWith("chrome://")){const r=document.getElementById("title");r&&n.title&&(r.value=n.title,r.placeholder="Page title (auto-filled)");const m=new URL(n.url);g(`📄 Ready to save: ${m.hostname}`,"info")}});const d=document.getElementById("labelSelect"),E=document.getElementById("labelInput"),I=document.querySelectorAll(".cat");I.forEach(e=>{e.addEventListener("click",()=>{I.forEach(n=>n.classList.remove("active")),e.classList.add("active"),B=e.dataset.cat,k()})});const k=()=>{const e=B==="link";P.style.display=e?"block":"none",w.style.display=e?"block":"none",document.getElementById("saveBtn").disabled=!e};k();chrome.storage.local.get(["boards","labels","links"],e=>{const n=(e.boards||[]).filter(t=>t.title!=="Default");n.length===0?w.style.display="none":n.forEach(t=>{const o=document.createElement("option");o.value=t.id,o.textContent=t.title,w.appendChild(o)});let r=e.labels||[];if((!r||r.length===0)&&e.links){const t=new Set;e.links.forEach(o=>{o.label&&t.add(o.label)}),r=Array.from(t)}const m=()=>{const t=document.createElement("option");return t.value="__new",t.textContent="➕ New label…",t};r.length?(d.style.display="block",d.innerHTML="",r.forEach(t=>{const o=document.createElement("option");o.value=t,o.textContent=t,d.appendChild(o)}),d.appendChild(m()),d.addEventListener("change",()=>{d.value==="__new"&&(d.style.display="none",E.style.display="block",E.focus())})):E.style.display="block",chrome.tabs.query({active:!0,currentWindow:!0},t=>{const o=t[0]?.id;o&&chrome.tabs.sendMessage(o,{type:"GET_LABELS"},h=>{if(chrome.runtime.lastError)return;const c=h?.labels||[];if(!c.length)return;const s=new Set;Array.from(d.options).forEach(l=>{l.value!=="__new"&&s.add(l.value)});let b=!1;c.forEach(l=>{if(!s.has(l)){const u=document.createElement("option");u.value=l,u.textContent=l;const a=d.querySelector('option[value="__new"]');a?d.insertBefore(u,a):d.appendChild(u),s.add(l),b=!0}}),b&&(d.style.display="block",E.style.display,chrome.storage.local.set({labels:Array.from(s)}))})})});chrome.tabs.query({active:!0,currentWindow:!0},e=>{const n=e[0],r=document.getElementById("title");r&&n&&n.title&&(r.value=n.title,document.getElementById("saveBtn").disabled=!1)});document.getElementById("saveBtn").addEventListener("click",()=>{if(document.getElementById("saveBtn").disabled=!0,C.textContent="Saving…",B!=="link"){C.textContent="Only Link saving supported right now.";return}const n=w.value;let r="";d&&d.style.display!=="none"&&(r=d.value==="__new"?"":d.value),E&&E.style.display!=="none"&&(r=E.value.trim());const m=document.getElementById("priority").value;chrome.tabs.query({active:!0,currentWindow:!0},t=>{const o=t[0];!o?.url||o.id===void 0||chrome.scripting.executeScript({target:{tabId:o.id},func:async()=>{const h=document.title||"",c=document.querySelector('meta[name="description"]')?.content||"";async function s(){await(async()=>{try{const i=Array.from(document.querySelectorAll("button, a, span")),f=/(read more|show more|continue reading|more…|more\u2026|read full)/i;i.forEach(p=>{if(f.test(p.textContent||""))try{p.click()}catch{}});for(let p=0;p<3;p++)window.scrollTo(0,document.body.scrollHeight),await new Promise(x=>setTimeout(x,350))}catch{}})();const u=()=>{const i=document.cloneNode(!0);return["script","style","nav","header","footer","aside",".ads",'[aria-label*="advert" i]','[role="banner" i]','[role="contentinfo" i]'].forEach(p=>{i.querySelectorAll(p).forEach(x=>x.remove())}),i};let a="";try{const{Readability:i}=await T(async()=>{const{Readability:p}=await import("https://cdn.jsdelivr.net/npm/@mozilla/readability@0.4.4/+esm");return{Readability:p}},[]),f=new i(u()).parse();f?.textContent&&(a=f.textContent)}catch{}if(a.trim().length<500)try{const i=document.body?.innerText||"";i.trim().length>a.length&&(a=i)}catch{}if(a.trim().length<500)try{const i=document.documentElement?.innerText||"";i.trim().length>a.length&&(a=i)}catch{}const y=[/get the .*app/i,/subscribe.*substack/i,/^share .*twitter$/i,/advertisement/i,/sponsored/i,/sign up/i];return a=a.split(`
`).filter(i=>{const f=i.trim();return!(!f||f.split(/\s+/).length<4||y.some(p=>p.test(f)))}).join(`
`),a.slice(0,5e5)}const b=await s();return{title:h,description:c,text:b}}},h=>{const c=h?.[0]?.result||{title:"",description:"",text:""},s=document.getElementById("saveBtn"),b=s.textContent;s.textContent="🔄 Saving...",s.disabled=!0,chrome.runtime.sendMessage({type:"SAVE_LINK",payload:{url:o.url,title:c.title,boardId:n,label:r,description:c.description,priority:m,tabId:o.id,pageText:c.text}},l=>{chrome.runtime.lastError?(g("❌ Failed to save. Please try again.","error"),v(s,b)):(g("✅ Page saved successfully!","success"),setTimeout(()=>window.close(),2e3))})})})});document.getElementById("openDashboardBtn").addEventListener("click",()=>{const e=document.getElementById("openDashboardBtn"),n=e.textContent;e.textContent="🔄 Opening...",e.disabled=!0,chrome.tabs.create({url:"http://localhost:5173/"},r=>{chrome.runtime.lastError?chrome.tabs.create({url:"https://smartresearchtracker.vercel.app/"},m=>{chrome.runtime.lastError?g("❌ Could not open dashboard. Make sure the app is running.","error"):g("✅ Dashboard opened successfully!","success"),v(e,n)}):(g("✅ Dashboard opened successfully!","success"),v(e,n))})});document.getElementById("openSettingsBtn").addEventListener("click",()=>{const e=document.getElementById("openSettingsBtn"),n=e.textContent;e.textContent="🔄 Opening...",e.disabled=!0,chrome.tabs.create({url:"http://localhost:5173/#/settings"},r=>{chrome.runtime.lastError?chrome.tabs.create({url:"https://smartresearchtracker.vercel.app/#/settings"},m=>{chrome.runtime.lastError?g("❌ Could not open settings. Make sure the app is running.","error"):g("✅ Settings opened successfully!","success"),v(e,n)}):(g("✅ Settings opened successfully!","success"),v(e,n))})});function g(e,n="info"){const r=document.getElementById("status");r.textContent=e,r.className=`status ${n}`,r.style.display="block",n==="success"&&setTimeout(()=>{r.style.display="none"},3e3)}function v(e,n){e.textContent=n,e.disabled=!1}
