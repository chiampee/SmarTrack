(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))m(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&m(h)}).observe(document,{childList:!0,subtree:!0});function r(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function m(t){if(t.ep)return;t.ep=!0;const n=r(t);fetch(t.href,n)}})();const L="modulepreload",P=function(e){return"/"+e},S={},T=function(o,r,m){let t=Promise.resolve();if(r&&r.length>0){let g=function(s){return Promise.all(s.map(u=>Promise.resolve(u).then(a=>({status:"fulfilled",value:a}),a=>({status:"rejected",reason:a}))))};var h=g;document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=i?.nonce||i?.getAttribute("nonce");t=g(r.map(s=>{if(s=P(s),s in S)return;S[s]=!0;const u=s.endsWith(".css"),a=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${a}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":L,u||(p.as="script"),p.crossOrigin="",p.href=s,l&&p.setAttribute("nonce",l),document.head.appendChild(p),u)return new Promise((c,f)=>{p.addEventListener("load",c),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})}))}function n(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return t.then(i=>{for(const l of i||[])l.status==="rejected"&&n(l.reason);return o().catch(n)})};console.log("🚀 Smart Research Tracker Extension Popup Loaded");let I="link";const v=document.getElementById("board"),_=document.getElementById("linkFields"),k=document.getElementById("status");chrome.storage.local.get(["firstLoad"],e=>{e.firstLoad||(E('👋 Welcome! Click "Save to Research" to save this page.',"info"),chrome.storage.local.set({firstLoad:!0}))});chrome.tabs.query({active:!0,currentWindow:!0},e=>{const o=e[0];o&&o.url&&!o.url.startsWith("chrome://")&&chrome.storage.sync.get({autoFillTitle:!0},r=>{const m=document.getElementById("title");m&&o.title&&r.autoFillTitle?(m.value=o.title,m.placeholder="Page title (auto-filled)"):m&&(m.placeholder="Page title");const t=new URL(o.url);document.getElementById("currentUrl").textContent=t.hostname})});const d=document.getElementById("labelSelect"),b=document.getElementById("labelInput"),C=document.querySelectorAll(".cat");C.forEach(e=>{e.addEventListener("click",()=>{C.forEach(o=>o.classList.remove("active")),e.classList.add("active"),I=e.dataset.cat,x()})});const x=()=>{const e=I==="link";_.style.display=e?"block":"none",v.style.display=e?"block":"none",document.getElementById("saveBtn").disabled=!e};x();chrome.storage.local.get(["boards","labels","links"],e=>{const o=(e.boards||[]).filter(t=>t.title!=="Default");o.length===0?v.style.display="none":o.forEach(t=>{const n=document.createElement("option");n.value=t.id,n.textContent=t.title,v.appendChild(n)});let r=e.labels||[];if((!r||r.length===0)&&e.links){const t=new Set;e.links.forEach(n=>{n.label&&t.add(n.label)}),r=Array.from(t)}const m=()=>{const t=document.createElement("option");return t.value="__new",t.textContent="➕ New label…",t};r.length?(d.style.display="block",d.innerHTML="",r.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,d.appendChild(n)}),d.appendChild(m()),d.addEventListener("change",()=>{d.value==="__new"&&(d.style.display="none",b.style.display="block",b.focus())})):b.style.display="block",chrome.tabs.query({active:!0,currentWindow:!0},t=>{const n=t[0]?.id;n&&chrome.tabs.sendMessage(n,{type:"GET_LABELS"},h=>{if(chrome.runtime.lastError)return;const i=h?.labels||[];if(!i.length)return;const l=new Set;Array.from(d.options).forEach(s=>{s.value!=="__new"&&l.add(s.value)});let g=!1;i.forEach(s=>{if(!l.has(s)){const u=document.createElement("option");u.value=s,u.textContent=s;const a=d.querySelector('option[value="__new"]');a?d.insertBefore(u,a):d.appendChild(u),l.add(s),g=!0}}),g&&(d.style.display="block",b.style.display,chrome.storage.local.set({labels:Array.from(l)}))})})});chrome.tabs.query({active:!0,currentWindow:!0},e=>{const o=e[0],r=document.getElementById("title");r&&o&&o.title&&(r.value=o.title,document.getElementById("saveBtn").disabled=!1)});document.getElementById("saveBtn").addEventListener("click",()=>{if(document.getElementById("saveBtn").disabled=!0,k.textContent="Saving…",I!=="link"){k.textContent="Only Link saving supported right now.";return}const o=v.value;let r="";d&&d.style.display!=="none"&&(r=d.value==="__new"?"":d.value),b&&b.style.display!=="none"&&(r=b.value.trim());const m=document.getElementById("priority").value;chrome.tabs.query({active:!0,currentWindow:!0},t=>{const n=t[0];!n?.url||n.id===void 0||chrome.scripting.executeScript({target:{tabId:n.id},func:async()=>{const h=document.title||"",i=document.querySelector('meta[name="description"]')?.content||"";async function l(){await(async()=>{try{const c=Array.from(document.querySelectorAll("button, a, span")),f=/(read more|show more|continue reading|more…|more\u2026|read full)/i;c.forEach(y=>{if(f.test(y.textContent||""))try{y.click()}catch{}});for(let y=0;y<3;y++)window.scrollTo(0,document.body.scrollHeight),await new Promise(B=>setTimeout(B,350))}catch{}})();const u=()=>{const c=document.cloneNode(!0);return["script","style","nav","header","footer","aside",".ads",'[aria-label*="advert" i]','[role="banner" i]','[role="contentinfo" i]'].forEach(y=>{c.querySelectorAll(y).forEach(B=>B.remove())}),c};let a="";try{const{Readability:c}=await T(async()=>{const{Readability:y}=await import("https://cdn.jsdelivr.net/npm/@mozilla/readability@0.4.4/+esm");return{Readability:y}},[]),f=new c(u()).parse();f?.textContent&&(a=f.textContent)}catch{}if(a.trim().length<500)try{const c=document.body?.innerText||"";c.trim().length>a.length&&(a=c)}catch{}if(a.trim().length<500)try{const c=document.documentElement?.innerText||"";c.trim().length>a.length&&(a=c)}catch{}const p=[/get the .*app/i,/subscribe.*substack/i,/^share .*twitter$/i,/advertisement/i,/sponsored/i,/sign up/i];return a=a.split(`
`).filter(c=>{const f=c.trim();return!(!f||f.split(/\s+/).length<4||p.some(y=>y.test(f)))}).join(`
`),a.slice(0,5e5)}const g=await l();return{title:h,description:i,text:g}}},h=>{const i=h?.[0]?.result||{title:"",description:"",text:""},l=document.getElementById("saveBtn"),g=l.textContent;l.textContent="🔄 Saving...",l.disabled=!0,chrome.runtime.sendMessage({type:"SAVE_LINK",payload:{url:n.url,title:i.title,boardId:o,label:r,description:i.description,priority:m,tabId:n.id,pageText:i.text}},s=>{chrome.runtime.lastError?(E("❌ Failed to save. Please try again.","error"),w(l,g)):(E("✅ Page saved successfully!","success"),chrome.storage.sync.get({autoClose:!0},u=>{u.autoClose&&setTimeout(()=>window.close(),2e3)}))})})})});document.getElementById("openDashboardBtn").addEventListener("click",()=>{const e=document.getElementById("openDashboardBtn"),o=e.textContent;e.textContent="🔄 Opening...",e.disabled=!0,chrome.storage.sync.get({dashboardUrl:"http://localhost:5173/",fallbackUrl:"https://smartresearchtracker.vercel.app/"},r=>{chrome.tabs.create({url:r.dashboardUrl},m=>{chrome.runtime.lastError?chrome.tabs.create({url:r.fallbackUrl},t=>{chrome.runtime.lastError?E("❌ Could not open dashboard. Check your settings.","error"):E("✅ Dashboard opened successfully!","success"),w(e,o)}):(E("✅ Dashboard opened successfully!","success"),w(e,o))})})});document.getElementById("minimalSettingsBtn").addEventListener("click",()=>{const e=document.getElementById("minimalSettingsPanel");e.style.display="block",A()});document.getElementById("closeMinimalSettings").addEventListener("click",()=>{const e=document.getElementById("minimalSettingsPanel");e.style.display="none"});function A(){chrome.storage.sync.get({dashboardUrl:"http://localhost:5173/",autoFillTitle:!0,autoClose:!0},e=>{document.getElementById("minimalDashboardUrl").value=e.dashboardUrl,document.getElementById("minimalAutoFill").checked=e.autoFillTitle,document.getElementById("minimalAutoClose").checked=e.autoClose})}document.getElementById("saveMinimalSettings").addEventListener("click",()=>{const e={dashboardUrl:document.getElementById("minimalDashboardUrl").value.trim(),autoFillTitle:document.getElementById("minimalAutoFill").checked,autoClose:document.getElementById("minimalAutoClose").checked};chrome.storage.sync.set(e,()=>{E("✅ Settings saved!","success"),setTimeout(()=>{document.getElementById("minimalSettingsPanel").style.display="none"},1500)})});document.getElementById("openFullSettingsFromMinimal").addEventListener("click",()=>{chrome.runtime.openOptionsPage(()=>{chrome.runtime.lastError&&chrome.tabs.create({url:"chrome://extensions/?id="+chrome.runtime.id})})});function E(e,o="info"){const r=document.getElementById("status");r.textContent=e,r.className=`status ${o}`,r.style.display="block",o==="success"&&setTimeout(()=>{r.style.display="none"},3e3)}function w(e,o){e.textContent=o,e.disabled=!1}
