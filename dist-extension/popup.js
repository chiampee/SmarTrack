(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function s(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(t){if(t.ep)return;t.ep=!0;const l=s(t);fetch(t.href,l)}})();const x="modulepreload",C=function(e){return"/"+e},w={},L=function(n,s,o){let t=Promise.resolve();if(s&&s.length>0){let h=function(c){return Promise.all(c.map(a=>Promise.resolve(a).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};var m=h;document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),d=i?.nonce||i?.getAttribute("nonce");t=h(s.map(c=>{if(c=C(c),c in w)return;w[c]=!0;const a=c.endsWith(".css"),g=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const r=document.createElement("link");if(r.rel=a?"stylesheet":x,a||(r.as="script"),r.crossOrigin="",r.href=c,d&&r.setAttribute("nonce",d),document.head.appendChild(r),a)return new Promise((y,f)=>{r.addEventListener("load",y),r.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(i){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=i,window.dispatchEvent(d),!d.defaultPrevented)throw i}return t.then(i=>{for(const d of i||[])d.status==="rejected"&&l(d.reason);return n().catch(l)})};console.log("🚀 Smart Research Tracker Extension Popup Loaded");let B="link";const P=document.getElementById("linkFields"),I=document.getElementById("status");chrome.storage.local.get(["firstLoad"],e=>{e.firstLoad||(E('👋 Welcome! Click "Save to Research" to save this page.',"info"),chrome.storage.local.set({firstLoad:!0}))});chrome.tabs.query({active:!0,currentWindow:!0},e=>{const n=e[0];n&&n.url&&!n.url.startsWith("chrome://")&&chrome.storage.sync.get({autoFillTitle:!0},s=>{const o=document.getElementById("title");o&&n.title&&s.autoFillTitle?(o.value=n.title,o.placeholder="Page title (auto-filled)"):o&&(o.placeholder="Page title");const t=new URL(n.url);document.getElementById("currentUrl").textContent=t.hostname})});const u=document.getElementById("labelSelect"),p=document.getElementById("labelInput"),S=document.querySelectorAll(".cat");S.forEach(e=>{e.addEventListener("click",()=>{S.forEach(n=>n.classList.remove("active")),e.classList.add("active"),B=e.dataset.cat,k()})});const k=()=>{const e=B==="link";P.style.display=e?"block":"none",document.getElementById("saveBtn").disabled=!e};k();chrome.storage.local.get(["labels","links"],e=>{let n=e.labels||[];if((!n||n.length===0)&&e.links){const o=new Set;e.links.forEach(t=>{t.label&&o.add(t.label)}),n=Array.from(o)}const s=()=>{const o=document.createElement("option");return o.value="__new",o.textContent="➕ New label…",o};n.length?(u.style.display="block",u.innerHTML="",n.forEach(o=>{const t=document.createElement("option");t.value=o,t.textContent=o,u.appendChild(t)}),u.appendChild(s()),u.addEventListener("change",()=>{u.value==="__new"&&(u.style.display="none",p.style.display="block",p.focus())})):p.style.display="block",chrome.tabs.query({active:!0,currentWindow:!0},o=>{const t=o[0]?.id;t&&chrome.tabs.sendMessage(t,{type:"GET_LABELS"},l=>{if(chrome.runtime.lastError)return;const m=l?.labels||[];if(!m.length)return;const i=new Set;Array.from(u.options).forEach(h=>{h.value!=="__new"&&i.add(h.value)});let d=!1;m.forEach(h=>{if(!i.has(h)){const c=document.createElement("option");c.value=h,c.textContent=h;const a=u.querySelector('option[value="__new"]');a?u.insertBefore(c,a):u.appendChild(c),i.add(h),d=!0}}),d&&(u.style.display="block",p.style.display,chrome.storage.local.set({labels:Array.from(i)}))})})});chrome.tabs.query({active:!0,currentWindow:!0},e=>{const n=e[0],s=document.getElementById("title");s&&n&&n.title&&(s.value=n.title,document.getElementById("saveBtn").disabled=!1)});document.getElementById("saveBtn").addEventListener("click",()=>{if(document.getElementById("saveBtn").disabled=!0,I.textContent="Saving…",B!=="link"){I.textContent="Only Link saving supported right now.";return}let n="";u&&u.style.display!=="none"&&(n=u.value==="__new"?"":u.value),p&&p.style.display!=="none"&&(n=p.value.trim());const s=document.getElementById("priority").value;chrome.tabs.query({active:!0,currentWindow:!0},o=>{const t=o[0];!t?.url||t.id===void 0||chrome.scripting.executeScript({target:{tabId:t.id},func:async()=>{const l=document.title||"",m=document.querySelector('meta[name="description"]')?.content||"";async function i(){await(async()=>{try{const r=Array.from(document.querySelectorAll("button, a, span")),y=/(read more|show more|continue reading|more…|more\u2026|read full)/i;r.forEach(f=>{if(y.test(f.textContent||""))try{f.click()}catch{}});for(let f=0;f<3;f++)window.scrollTo(0,document.body.scrollHeight),await new Promise(b=>setTimeout(b,350))}catch{}})();const c=()=>{const r=document.cloneNode(!0);return["script","style","nav","header","footer","aside",".ads",'[aria-label*="advert" i]','[role="banner" i]','[role="contentinfo" i]'].forEach(f=>{r.querySelectorAll(f).forEach(b=>b.remove())}),r};let a="";try{const{Readability:r}=await L(async()=>{const{Readability:f}=await import("https://cdn.jsdelivr.net/npm/@mozilla/readability@0.4.4/+esm");return{Readability:f}},[]),y=new r(c()).parse();y?.textContent&&(a=y.textContent)}catch{}if(a.trim().length<500)try{const r=document.body?.innerText||"";r.trim().length>a.length&&(a=r)}catch{}if(a.trim().length<500)try{const r=document.documentElement?.innerText||"";r.trim().length>a.length&&(a=r)}catch{}const g=[/get the .*app/i,/subscribe.*substack/i,/^share .*twitter$/i,/advertisement/i,/sponsored/i,/sign up/i];return a=a.split(`
`).filter(r=>{const y=r.trim();return!(!y||y.split(/\s+/).length<4||g.some(f=>f.test(y)))}).join(`
`),a.slice(0,5e5)}const d=await i();return{title:l,description:m,text:d}}},l=>{const m=l?.[0]?.result||{title:"",description:"",text:""},i=document.getElementById("saveBtn"),d=i.textContent;i.textContent="🔄 Saving...",i.disabled=!0,chrome.runtime.sendMessage({type:"SAVE_LINK",payload:{url:t.url,title:m.title,label:n,description:m.description,priority:s,tabId:t.id,pageText:m.text}},h=>{chrome.runtime.lastError?(E("❌ Failed to save. Please try again.","error"),v(i,d)):(E("✅ Page saved successfully!","success"),chrome.storage.sync.get({autoClose:!0},c=>{c.autoClose&&setTimeout(()=>window.close(),2e3)}))})})})});document.getElementById("openDashboardBtn").addEventListener("click",()=>{const e=document.getElementById("openDashboardBtn"),n=e.textContent;e.textContent="🔄 Opening...",e.disabled=!0,chrome.storage.sync.get({dashboardUrl:"http://localhost:5173/",fallbackUrl:"https://smartresearchtracker.vercel.app/"},s=>{chrome.tabs.create({url:s.dashboardUrl},o=>{chrome.runtime.lastError?chrome.tabs.create({url:s.fallbackUrl},t=>{chrome.runtime.lastError?E("❌ Could not open dashboard. Check your settings.","error"):E("✅ Dashboard opened successfully!","success"),v(e,n)}):(E("✅ Dashboard opened successfully!","success"),v(e,n))})})});document.getElementById("minimalSettingsBtn").addEventListener("click",()=>{const e=document.getElementById("minimalSettingsPanel");e.style.display="block",T()});document.getElementById("closeMinimalSettings").addEventListener("click",()=>{const e=document.getElementById("minimalSettingsPanel");e.style.display="none"});function T(){chrome.storage.sync.get({dashboardUrl:"http://localhost:5173/",autoFillTitle:!0,autoClose:!0},e=>{document.getElementById("minimalDashboardUrl").value=e.dashboardUrl,document.getElementById("minimalAutoFill").checked=e.autoFillTitle,document.getElementById("minimalAutoClose").checked=e.autoClose})}document.getElementById("saveMinimalSettings").addEventListener("click",()=>{const e={dashboardUrl:document.getElementById("minimalDashboardUrl").value.trim(),autoFillTitle:document.getElementById("minimalAutoFill").checked,autoClose:document.getElementById("minimalAutoClose").checked};chrome.storage.sync.set(e,()=>{E("✅ Settings saved!","success"),setTimeout(()=>{document.getElementById("minimalSettingsPanel").style.display="none"},1500)})});document.getElementById("openFullSettingsFromMinimal").addEventListener("click",()=>{chrome.runtime.openOptionsPage(()=>{chrome.runtime.lastError&&chrome.tabs.create({url:"chrome://extensions/?id="+chrome.runtime.id})})});function E(e,n="info"){const s=document.getElementById("status");s.textContent=e,s.className=`status ${n}`,s.style.display="block",n==="success"&&setTimeout(()=>{s.style.display="none"},3e3)}function v(e,n){e.textContent=n,e.disabled=!1}
